{% extends "layouts/base.html" %}

{% block title %} {{title}} {% endblock %} 

<!-- Specific CSS goes HERE -->
{% block stylesheets %}{% endblock stylesheets %}

{% block content %}

<div class="pcoded-content">
    <div class="pcoded-inner-content">
        <!-- [ breadcrumb ] start -->
        <div class="page-header">
            <div class="page-block">
                <div class="row align-items-center">
                    <div class="col-md-12">
                        <div class="page-header-title">
                            <h3 class="m-b-10">{{title}}</h3>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        <!-- [ breadcrumb ] end -->
        <div class="main-body">
            <div class="page-wrapper">
                <!-- [ Main Content ] start -->
                <div class="row">
                    <!-- [ Search-form-table ] start -->
                    <div class="col-xl-12">
                        <div class="card">
                            <div class="card-body">
                                <form action="" method="POST" id='form'>
                                    <div>
                                        {% csrf_token %}
                                        {% if form.non_field_errors %}
                                            <button type="button" class="btn btn-danger">
                                                {{ form.non_field_errors.as_text }}
                                            </button><br>
                                        {% endif %}
                                        {{ form }}
                                    </div>
                                    <span>
                                        <button class="btn btn-primary" type="Submit">Search</button>
                                    </span>
                                </form>
                            </div>
                        </div>
                    </div>
                    <!-- [ Search-form-table ] end -->
                </div>
                {% if players %}
                <div class="row">
                    <!-- [ Search-results-table ] start -->
                    <div class="col-xl-12">
                        <div class="card">
                            <div class="card-block table-border-style">
                                <div class="table-responsive">
                                    <div id="chart" ></div>
                                </div>
                            </div>
                        </div>
                    </div>
                    <!-- [ Search-results-table ] end -->
                </div>
                {% endif %}
                <!-- [ Main Content ] end -->
            </div>
        </div>
    </div>
</div>

{% endblock content %}

<!-- Specific Page JS goes HERE  -->
{% block javascripts %}
<script>
$('.errorlist').hide()
var chartId = document.getElementById("chart");
var x = {{x}};
var y = {{y}};
var names = {{players|safe}};
var size = {{size}};
var len = x.length;
var max_size = {{max_size}}

var data = []

for(var indx = 0; indx < len; indx++){
                var size_ = Math.round(((size[indx]/10) - 1) * max_size * 100)/100
                data.push({
                    x: [x[indx]],
                    y: [y[indx]],
                    mode: 'markers',
                    name: names[indx],
                    text: [`${names[indx]} ${size_}`],
                    marker: {
                        size: [size[indx]]
                        },
                    type: 'scatter'
                });
            }


var x_axis_tittle = $('#id_x_axis option:selected').text()
var y_axis_tittle = $('#id_y_axis option:selected').text()
var size_points = $('#id_size_points option:selected').text()

var layout = {
  title: {
    text:'BPL Goalkeepers',
    font: {
      size: 24
    }
  },
  xaxis: {
    title: {
      text: x_axis_tittle,
      font: {
        size: 18
      }
    }
  },
  yaxis: {
    title: {
      text: y_axis_tittle,
      font: {
        size: 18
      }
    }
  },
  height: 700,
  showlegend: true,
}

var config = {responsive: true}

Plotly.newPlot(chartId, data, layout, config);

   
// $(document).on('submit', '#form', function (event) {    

//     if ((new Set([x_axis_tittle, y_axis_tittle, size_points])).size < 3 ) {
//         alert('Picked value in form must be unique!')
//         event.preventDefault();         
//         return false;  
//     } else {
//         return True
//     }
        
// }); 

</script>
{% endblock javascripts %}
